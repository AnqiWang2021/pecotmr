---
title: "SuSiE RSS with QC"
output: html_document
date: "2023-12-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview

We demonstrates how we use SuSiE RSS wrapper implemented in `pecotmr` package to fine-map using summary statistics and reference LD panel data precomputed and available as resources.

To load the `pecotmr` package,

```{r load-pkgs}
library(pecotmr)
```

## Load summary statistics and corresponding LD matrix

For given region of interest, we load the LD matrix and corresponding summary statistics data:

```{r}
LD_meta_data = data.frame(chrom = "chr1",start = 50179506, end = 54277735, path = "ROSMAP_NIA_WGS.leftnorm.filtered.filtered.chr1_50179506_54277735.float16.txt.xz")
region = c("chr1", 51800000, 53927212)
```

```{r}
LD_data = load_LD_matrix(LD_meta_data, region, extract_variants$variant_allele_flip)
```

## Summary statistics QC

Match variants and LD matrix by ("chr", "A1", "A2" and "pos"), accounting for possible strand flips and major/minor allele flips (opposite effects and zscores). We use LD data as reference to match the summary statistics to:

```{r}
sumstats = readRDS("sumstat.rds")
```

```{r}
allele_fip = allele_qc(sumstats,reference,match.min.prop=0.2,remove_dups=TRUE,flip=TRUE,remove=TRUE)
```